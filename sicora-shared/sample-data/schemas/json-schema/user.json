{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://sicora-app.sena.edu.co/schemas/user.json",
  "title": "Usuario",
  "description": "Esquema para validación de datos de usuario en carga masiva",
  "type": "object",
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Identificador único del usuario (UUID v4)"
    },
    "nombre": {
      "type": "string",
      "minLength": 2,
      "maxLength": 50,
      "pattern": "^[a-zA-ZáéíóúüñÁÉÍÓÚÜÑ\\s]+$",
      "description": "Nombre del usuario"
    },
    "apellido": {
      "type": "string",
      "minLength": 2,
      "maxLength": 50,
      "pattern": "^[a-zA-ZáéíóúüñÁÉÍÓÚÜÑ\\s]+$",
      "description": "Apellido del usuario"
    },
    "email": {
      "type": "string",
      "format": "email",
      "maxLength": 100,
      "description": "Correo electrónico único del usuario"
    },
    "documento": {
      "type": "string",
      "minLength": 7,
      "maxLength": 15,
      "pattern": "^[0-9]+$",
      "description": "Número de documento de identidad"
    },
    "rol": {
      "type": "string",
      "enum": ["aprendiz", "instructor", "admin", "coordinador"],
      "description": "Rol del usuario en el sistema"
    },
    "contraseña": {
      "type": "string",
      "minLength": 10,
      "pattern": "^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]",
      "description": "Contraseña que cumple políticas de seguridad o hash bcrypt"
    },
    "ficha_id": {
      "type": ["string", "null"],
      "pattern": "^[0-9]{7}$",
      "description": "Número de ficha del aprendiz (7 dígitos). Solo obligatorio para rol 'aprendiz'. Un aprendiz solo puede estar en una ficha."
    },
    "programa": {
      "type": "string",
      "minLength": 3,
      "maxLength": 100,
      "description": "Nombre del programa de formación (para aprendices) o área de especialización (para instructores/admin/coordinadores)"
    },
    "is_active": {
      "type": "boolean",
      "default": true,
      "description": "Indica si el usuario está activo en el sistema"
    },
    "must_change_password": {
      "type": "boolean",
      "default": true,
      "description": "Indica si el usuario debe cambiar su contraseña en el próximo login"
    },
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "Fecha y hora de creación en formato ISO 8601"
    },
    "last_login": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "Última fecha y hora de login en formato ISO 8601"
    }
  },
  "required": [
    "id",
    "nombre",
    "apellido",
    "email",
    "documento",
    "rol",
    "contraseña",
    "programa",
    "created_at"
  ],
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": { "rol": { "const": "aprendiz" } }
      },
      "then": {
        "required": ["ficha_id"],
        "properties": {
          "ficha_id": {
            "type": "string",
            "pattern": "^[0-9]{7}$"
          }
        }
      },
      "else": {
        "properties": {
          "ficha_id": {
            "type": "null"
          }
        }
      }
    }
  ],
  "examples": [
    {
      "id": "cb87e4eb-8b86-4a8d-9c5d-e8f8a9b0c1d2",
      "nombre": "Juan",
      "apellido": "Pérez",
      "email": "juan.perez@sena.edu.co",
      "documento": "12345678",
      "rol": "aprendiz",
      "contraseña": "$2b$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewmDBOOsRxUgAQ4G",
      "ficha_id": "2826503",
      "programa": "Análisis y Desarrollo de Software",
      "is_active": true,
      "must_change_password": true,
      "created_at": "2025-06-15T18:30:00Z",
      "last_login": null
    },
    {
      "id": "a7d8e9f0-1a2b-3c4d-5e6f-7a8b9c0d1e2f",
      "nombre": "María",
      "apellido": "González",
      "email": "maria.gonzalez@sena.edu.co",
      "documento": "87654321",
      "rol": "instructor",
      "contraseña": "$2b$12$example.hash.here",
      "ficha_id": null,
      "programa": "Instructora de Programación",
      "is_active": true,
      "must_change_password": false,
      "created_at": "2025-06-15T18:30:00Z",
      "last_login": "2025-06-15T19:00:00Z"
    }
  ]
}

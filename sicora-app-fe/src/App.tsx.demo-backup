import { BrowserRouter } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { AppRouter } from './router';
import { useUserStore } from './stores/userStore';
import { useEffect } from 'react';

/**
 * SICORA - Sistema de Informaci√≥n de Coordinaci√≥n Acad√©mica
 * Frontend con React 19 + Vite + TailwindCSS
 * Dise√±o institucional SENA 2024 - Manual de Identidad
 *
 * App principal con React Router, React Query y Zustand
 */

// Configurar React Query client
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 1,
      refetchOnWindowFocus: false,
      staleTime: 5 * 60 * 1000, // 5 minutos
    },
  },
});

function App() {
  const [currentUser, setCurrentUser] = useState<DemoUser>(demoUsers.admin);
  const [currentView, setCurrentView] = useState('/dashboard');
  const [layoutType, setLayoutType] = useState<'hero' | 'simple' | 'dashboard' | 'search'>(
    'dashboard'
  );
  const [activeTab, setActiveTab] = useState<'layout' | 'buttons'>('layout');

  const handleRoleChange = (role: UserRole) => {
    setCurrentUser(demoUsers[role]);
    setCurrentView('/dashboard');
  };

  const handleNavigate = (href: string) => {
    setCurrentView(href);
    console.log('Navegando a:', href);
  };

  const handleLogout = () => {
    console.log('Cerrando sesi√≥n...');
    // Aqu√≠ ir√≠a la l√≥gica de logout
  };

  const handleSearch = (query: string, filters?: Record<string, unknown>) => {
    console.log('B√∫squeda:', query, filters);
    // Aqu√≠ ir√≠a la l√≥gica de b√∫squeda
  };

  const renderContent = () => (
    <>
      {/* Demo de Navegaci√≥n por Roles */}
      <div className='text-center mb-8'>
        <h2 className='text-3xl font-sena-heading font-bold text-gray-900 mb-4'>
          üöÄ ¬°SICORA con Layout Institucional SENA!
        </h2>
        <p className='text-lg font-sena-body text-gray-600 mb-6 max-w-2xl mx-auto'>
          Sistema completo con header, footer, breadcrumbs y b√∫squeda institucional inspirado en
          SofiaPlus
        </p>

        {/* Selector de Layout */}
        <div className='bg-white p-6 rounded-lg shadow-md border border-gray-100 mb-6'>
          <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-4'>
            üé® Tipo de Layout Institucional
          </h3>
          <div className='flex flex-wrap justify-center gap-3 mb-4'>
            <Button
              variant={layoutType === 'hero' ? 'primary' : 'outline'}
              size='sm'
              onClick={() => setLayoutType('hero')}
            >
              Hero Layout
            </Button>
            <Button
              variant={layoutType === 'dashboard' ? 'primary' : 'outline'}
              size='sm'
              onClick={() => setLayoutType('dashboard')}
            >
              Dashboard
            </Button>
            <Button
              variant={layoutType === 'simple' ? 'primary' : 'outline'}
              size='sm'
              onClick={() => setLayoutType('simple')}
            >
              Simple
            </Button>
            <Button
              variant={layoutType === 'search' ? 'primary' : 'outline'}
              size='sm'
              onClick={() => setLayoutType('search')}
            >
              Con B√∫squeda
            </Button>
          </div>
          <p className='text-sm text-gray-600 font-sena-body'>
            <strong>Layout actual:</strong>{' '}
            {layoutType === 'hero'
              ? 'Hero con b√∫squeda prominente (estilo SofiaPlus)'
              : layoutType === 'dashboard'
                ? 'Dashboard con b√∫squeda compacta'
                : layoutType === 'simple'
                  ? 'Simple con breadcrumbs'
                  : 'Completo con b√∫squeda expandida'}
          </p>
        </div>

        {/* Selector de Roles para Demo */}
        <div className='bg-white p-6 rounded-lg shadow-md border border-gray-100 mb-8'>
          <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-4'>
            üé≠ Cambiar Rol de Usuario (Demo)
          </h3>
          <div className='flex flex-wrap justify-center gap-3'>
            {Object.entries(demoUsers).map(([role, user]) => (
              <Button
                key={role}
                variant={currentUser.role === role ? 'primary' : 'outline'}
                size='md'
                onClick={() => handleRoleChange(role as keyof typeof demoUsers)}
                className='flex items-center space-x-2'
              >
                <span>
                  {role === 'admin' && 'üëë'}
                  {role === 'instructor' && 'üë®‚Äçüè´'}
                  {role === 'aprendiz' && 'üéì'}
                  {role === 'coordinador' && 'üìã'}
                  {role === 'administrativo' && 'üè¢'}
                </span>
                <span className='capitalize'>{role}</span>
              </Button>
            ))}
          </div>
          <div className='mt-4 text-sm text-gray-600 font-sena-body'>
            <strong>Usuario actual:</strong> {currentUser.name} ({currentUser.role})
            {currentUser.coordination && <span> - {currentUser.coordination}</span>}
            {currentUser.ficha && <span> - Ficha: {currentUser.ficha}</span>}
          </div>
        </div>

        {/* Informaci√≥n de la Vista Actual */}
        <div className='bg-sena-primary-50 p-4 rounded-lg border border-sena-primary-200 mb-8'>
          <div className='flex items-center justify-center space-x-2 text-sena-primary-700'>
            <span className='text-xl'>üìç</span>
            <span className='font-sena-body font-medium'>
              Vista actual:{' '}
              <code className='bg-white px-2 py-1 rounded font-sena-mono text-sm'>
                {currentView}
              </code>
            </span>
          </div>
        </div>
      </div>

      {/* Caracter√≠sticas del Sistema */}
      <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8'>
        <div className='bg-white p-6 rounded-lg shadow-md border border-gray-100'>
          <div className='w-12 h-12 bg-sena-primary-100 rounded-lg flex items-center justify-center mx-auto mb-4'>
            <span className='text-2xl'>ÔøΩÔ∏è</span>
          </div>
          <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-2'>
            Layout Institucional
          </h3>
          <p className='text-gray-600 font-sena-body text-sm'>
            Header, footer, breadcrumbs y b√∫squeda inspirados en sistemas SENA como SofiaPlus
          </p>
        </div>

        <div className='bg-white p-6 rounded-lg shadow-md border border-gray-100'>
          <div className='w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4'>
            <span className='text-2xl'>ÔøΩ</span>
          </div>
          <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-2'>
            B√∫squeda Inteligente
          </h3>
          <p className='text-gray-600 font-sena-body text-sm'>
            Barra de b√∫squeda contextual con sugerencias espec√≠ficas por rol de usuario
          </p>
        </div>

        <div className='bg-white p-6 rounded-lg shadow-md border border-gray-100'>
          <div className='w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4'>
            <span className='text-2xl'>üß≠</span>
          </div>
          <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-2'>
            Navegaci√≥n Contextual
          </h3>
          <p className='text-gray-600 font-sena-body text-sm'>
            Breadcrumbs autom√°ticos y navegaci√≥n espec√≠fica seg√∫n el rol del usuario
          </p>
        </div>

        <div className='bg-white p-6 rounded-lg shadow-md border border-gray-100'>
          <div className='w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-4'>
            <span className='text-2xl'>ÔøΩ</span>
          </div>
          <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-2'>
            Responsive Design
          </h3>
          <p className='text-gray-600 font-sena-body text-sm'>
            Dise√±o adaptativo con men√∫s m√≥viles y layout optimizado para todos los dispositivos
          </p>
        </div>

        <div className='bg-white p-6 rounded-lg shadow-md border border-gray-100'>
          <div className='w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mx-auto mb-4'>
            <span className='text-2xl'>üé®</span>
          </div>
          <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-2'>
            Identidad SENA
          </h3>
          <p className='text-gray-600 font-sena-body text-sm'>
            Colores, tipograf√≠as y componentes alineados con el manual de identidad SENA 2024
          </p>
        </div>

        <div className='bg-white p-6 rounded-lg shadow-md border border-gray-100'>
          <div className='w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mx-auto mb-4'>
            <span className='text-2xl'>‚ö°</span>
          </div>
          <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-2'>
            Listo para Producci√≥n
          </h3>
          <p className='text-gray-600 font-sena-body text-sm'>
            Componentes listos para integrarse con React Router y backend real
          </p>
        </div>
      </div>

      {/* Tecnolog√≠as utilizadas */}
      <div className='mt-16'>
        <h3 className='text-lg font-sena-heading font-semibold text-gray-900 mb-6 text-center'>
          Tecnolog√≠as del Frontend SICORA
        </h3>
        <div className='flex flex-wrap justify-center gap-4'>
          <span className='px-3 py-1 bg-blue-100 text-blue-800 text-sm font-sena-mono rounded-md'>
            React 19
          </span>
          <span className='px-3 py-1 bg-green-100 text-green-800 text-sm font-sena-mono rounded-md'>
            Vite 7.0
          </span>
          <span className='px-3 py-1 bg-purple-100 text-purple-800 text-sm font-sena-mono rounded-md'>
            TypeScript 5.7
          </span>
          <span className='px-3 py-1 bg-cyan-100 text-cyan-800 text-sm font-sena-mono rounded-md'>
            TailwindCSS 3.5
          </span>
          <span className='px-3 py-1 bg-orange-100 text-orange-800 text-sm font-sena-mono rounded-md'>
            Layout Institucional
          </span>
          <span className='px-3 py-1 bg-pink-100 text-pink-800 text-sm font-sena-mono rounded-md'>
            B√∫squeda SENA
          </span>
        </div>
      </div>
    </>
  );

  // Renderizar el layout apropiado
  if (layoutType === 'hero') {
    return (
      <HeroLayout
        user={currentUser}
        currentPath={currentView}
        pageTitle='Dashboard SICORA'
        heroTitle={
          currentUser.role === 'admin'
            ? '¬°Bienvenido Administrador!'
            : currentUser.role === 'instructor'
              ? '¬°Bienvenido Instructor!'
              : currentUser.role === 'coordinador'
                ? '¬°Bienvenido Coordinador!'
                : currentUser.role === 'aprendiz'
                  ? '¬°Bienvenido Aprendiz!'
                  : '¬°Bienvenido al Sistema!'
        }
        heroSubtitle='Sistema integral de gesti√≥n acad√©mica del CGMLTI SENA'
        onNavigate={handleNavigate}
        onLogout={handleLogout}
        onSearch={handleSearch}
      >
        {renderContent()}
      </HeroLayout>
    );
  }

  if (layoutType === 'dashboard') {
    return (
      <DashboardLayout
        user={currentUser}
        currentPath={currentView}
        pageTitle='Dashboard SICORA'
        onNavigate={handleNavigate}
        onLogout={handleLogout}
        onSearch={handleSearch}
      >
        {renderContent()}
      </DashboardLayout>
    );
  }

  if (layoutType === 'simple') {
    return (
      <SimpleLayout
        user={currentUser}
        currentPath={currentView}
        pageTitle='Dashboard SICORA'
        onNavigate={handleNavigate}
        onLogout={handleLogout}
      >
        {renderContent()}
      </SimpleLayout>
    );
  }

  // Layout con b√∫squeda
  return (
    <InstitutionalLayout
      user={currentUser}
      currentPath={currentView}
      pageTitle='Dashboard SICORA'
      showSearchBar={true}
      showBreadcrumbs={true}
      onNavigate={handleNavigate}
      onLogout={handleLogout}
      onSearch={handleSearch}
    >
      {renderContent()}
    </InstitutionalLayout>
  );
}

export default App;
